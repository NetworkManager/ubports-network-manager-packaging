From 197e87820c5211a84ffcd01d940f920b10b5607b Mon Sep 17 00:00:00 2001
From: Tony Espy <espy@canonical.com>
Date: Tue, 24 May 2016 21:41:18 -0400
Subject: [PATCH 18/18] Fix openvpn by handling do_add_route EEXISTS

This patch fixes issues with the updated Netlink code in
NMLinuxPlatform and ineroperability with older ( <= 3.10 )
kernels.

Add EEXIST logic similar to logic found in 0.9.10 to the
NMLinuxPlatform do_add_addroute().

Bug-Ubuntu: https://bugs.launchpad.net/bugs/1579222
---
 src/platform/nm-linux-platform.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/platform/nm-linux-platform.c b/src/platform/nm-linux-platform.c
index c0224fff10..e6f3bef050 100644
--- a/src/platform/nm-linux-platform.c
+++ b/src/platform/nm-linux-platform.c
@@ -5219,6 +5219,11 @@ do_add_addrroute (NMPlatform *platform,
 			do_request_one_type (platform, NMP_OBJECT_GET_TYPE (obj_id));
 	}
 
+	if (seq_result == -EEXIST) {
+		_LOGI ("do_add_addroute: seq_restul == -EEXISTS; treating as OK");
+		seq_result = WAIT_FOR_NL_RESPONSE_RESULT_RESPONSE_OK;
+	}
+
 	return wait_for_nl_response_to_plerr (seq_result);
 }
 
-- 
2.20.1

